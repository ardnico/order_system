{% extends "base.html" %}
{% block content %}
<h1>{{ strings['templates.heading'] }}</h1>
<div class="grid">
    <div class="card">
        <h3>新規テンプレート</h3>
        <form method="post">
            <label>Title<input type="text" name="title" required></label>
            <label>Default category<input type="text" name="default_category"></label>
            <label>Default points<input type="number" name="default_points"></label>
            <label>Relative due days<input type="number" name="relative_due_days" placeholder="e.g. 3"></label>
            <label>Memo<textarea name="memo"></textarea></label>
            <label>{{ strings['templates.instructions'] }} (AsciiDoc OK)<textarea name="instructions" placeholder="= Heading\n* step\nimage::https://..."></textarea></label>
            <label>Instruction image URL<input type="url" name="instruction_image_url"></label>
            <button type="submit">Save</button>
        </form>
    </div>
    <div class="card">
        <h3>Existing templates</h3>
        {% if templates %}
            {% for t in templates %}
            <div class="template-edit">
                <div class="template-preview">
                    <h4>{{ t.title }}</h4>
                    <p class="muted">{{ t.default_category or '-' }} / ⭐ {{ t.default_points or '-' }} / +{{ t.relative_due_days if t.relative_due_days is not none else '-' }} days</p>
                    {% if t.instructions %}
                        <div class="instruction-body">{{ render_instructions(t.instructions) }}</div>
                    {% endif %}
                    {% if t.instruction_image_url %}
                        <div class="instruction-image-wrap"><img src="{{ t.instruction_image_url }}" alt="template image"></div>
                    {% endif %}
                </div>
                <form method="post" action="/templates/tasks/{{ t.id }}/edit" class="template-form">
                    <label>Title<input type="text" name="title" value="{{ t.title }}" required></label>
                    <label>Default category<input type="text" name="default_category" value="{{ t.default_category or '' }}"></label>
                    <label>Default points<input type="number" name="default_points" value="{{ t.default_points or '' }}"></label>
                    <label>Relative due days<input type="number" name="relative_due_days" value="{{ t.relative_due_days if t.relative_due_days is not none else '' }}"></label>
                    <label>Memo<textarea name="memo">{{ t.memo or '' }}</textarea></label>
                    <label>{{ strings['templates.instructions'] }}<textarea name="instructions">{{ t.instructions or '' }}</textarea></label>
                    <label>Instruction image URL<input type="url" name="instruction_image_url" value="{{ t.instruction_image_url or '' }}"></label>
                    <div class="actions">
                        <button type="submit">Update</button>
                    </div>
                </form>
                <form method="post" action="/templates/tasks/{{ t.id }}/delete" class="inline">
                    <button type="submit" class="ghost">Delete</button>
                </form>
            </div>
            {% endfor %}
        {% else %}
        <p>No templates yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
