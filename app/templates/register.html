{% extends "base.html" %}
{% block content %}
<h1>{{ strings['auth.register.title'] }}</h1>
<form method="post" class="card">
    <label>
        {{ strings['auth.register.displayName'] }}
        <input type="text" name="display_name" required>
    </label>
    <label>
        {{ strings['auth.register.email'] }}
        <input type="email" name="email" required>
    </label>
    <label>
        {{ strings['auth.register.password'] }}
        <input type="password" name="password" required>
    </label>
    <div class="radio-row">
        <label><input type="radio" name="create_household" value="1" checked> {{ strings['auth.register.createHousehold'] }}</label>
        <label><input type="radio" name="create_household" value="" > {{ strings['auth.register.joinExisting'] }}</label>
    </div>
    <div id="new-household">
        <label>
            {{ strings['auth.register.householdName'] }}
            <input type="text" name="household_name">
        </label>
        <label>
            {{ strings['auth.register.joinCodeOptional'] }}
            <input type="text" name="new_join_code" placeholder="{{ strings['settings.joinCode.placeholder'] }}">
        </label>
    </div>
    <div id="existing-household" class="hidden">
        <label>
            {{ strings['auth.register.selectHousehold'] }}
            <select name="household_id">
                <option value="">{{ strings['auth.selectPlaceholder'] }}</option>
                {% for h in households %}
                <option value="{{ h.id }}">{{ h.name }}</option>
                {% endfor %}
            </select>
        </label>
        <label>
            {{ strings['auth.register.joinCodeExisting'] }}
            <input type="text" name="existing_join_code" placeholder="{{ strings['settings.joinCode.description'] }}">
        </label>
    </div>
    <button type="submit">{{ strings['auth.register.submit'] }}</button>
</form>
<p>{{ strings['auth.register.loginLink'] }} <a href="/login">{{ strings['auth.login.title'] }}</a></p>
<script>
const createRadio = document.querySelector('input[name="create_household"][value="1"]');
const joinRadio = document.querySelector('input[name="create_household"][value=""]');
const newSection = document.getElementById('new-household');
const existingSection = document.getElementById('existing-household');
const newJoin = document.querySelector('input[name="new_join_code"]');
const existingJoin = document.querySelector('input[name="existing_join_code"]');
const householdSelect = document.querySelector('select[name="household_id"]');
function toggleSections() {
    const creating = createRadio.checked;
    newSection.classList.toggle('hidden', !creating);
    existingSection.classList.toggle('hidden', creating);
    if (newJoin && existingJoin && householdSelect) {
        newJoin.disabled = !creating;
        existingJoin.disabled = creating;
        householdSelect.disabled = creating;
        existingJoin.required = !creating;
        householdSelect.required = !creating;
    }
}
createRadio.addEventListener('change', toggleSections);
joinRadio.addEventListener('change', toggleSections);
toggleSections();
</script>
{% endblock %}
